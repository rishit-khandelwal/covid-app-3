<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>COVID3</title>

    <link rel="manifest" href="/manifest.json" />
    <link rel="apple-touch-icon" href="icons/apple-icon-180.png" />
    <link rel="icon" href="icons/manifest-icon-512.png" />

    <meta name="apple-mobile-web-app-capable" content="yes" />

    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2048-2732.jpg"
      media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2732-2048.jpg"
      media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1668-2388.jpg"
      media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2388-1668.jpg"
      media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1536-2048.jpg"
      media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2048-1536.jpg"
      media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1668-2224.jpg"
      media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2224-1668.jpg"
      media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1620-2160.jpg"
      media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2160-1620.jpg"
      media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1284-2778.jpg"
      media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2778-1284.jpg"
      media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1170-2532.jpg"
      media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2532-1170.jpg"
      media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1125-2436.jpg"
      media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2436-1125.jpg"
      media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1242-2688.jpg"
      media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2688-1242.jpg"
      media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-828-1792.jpg"
      media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1792-828.jpg"
      media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1242-2208.jpg"
      media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-2208-1242.jpg"
      media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-750-1334.jpg"
      media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1334-750.jpg"
      media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-640-1136.jpg"
      media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    />
    <link
      rel="apple-touch-startup-image"
      href="icons/apple-splash-1136-640.jpg"
      media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    />

    <script src="https://unpkg.com/vue@3.0.11/dist/vue.global.prod.js"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"
    ></script>
  </head>
  <body>
    <div id="loading">loading</div>
    <div id="root">
      <div class="latest">
        <div id="cases" @click="switchMode">
          <span v-if="showNewCases">New Cases: {{ latestConfirmed }}</span>
          <span v-if="!showNewCases"
            >Total Confirmed: {{ totalConfirmed }}</span
          >
        </div>
      </div>
    </div>
    <canvas id="chart"></canvas>

    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("/worker.js");
      }
      var chart;
      const app = Vue.createApp({
        data() {
          return {
            latestConfirmed: undefined,
            totalConfirmedArray: undefined,
            totalConfirmedGrowthArray: undefined,
            totalConfirmedArray: undefined,
            showNewCases: true,
          };
        },
        methods: {
          main(data) {
            this.totalConfirmedArray = data.map((v) => v["Confirmed"]);
            this.totalConfirmed =
              this.totalConfirmedArray[this.totalConfirmedArray.length - 1];
            this.totalConfirmedGrowthArray = this.growthArray(
              this.totalConfirmedArray
            );
            this.latestConfirmed =
              data[data.length - 1]["Confirmed"] -
              data[data.length - 2]["Confirmed"];

            this.drawChart();

            this.done();
          },
          growthArray(arr) {
            return arr.map((v, i, ar) => {
              if (i == 0) {
                return v;
              }

              return v - ar[i - 1];
            });
          },
          switchMode() {
            this.showNewCases = !this.showNewCases;
            this.drawChart();
          },
          drawChart() {
            const canvas = document.getElementById("chart");
            const canvasCtx = canvas.getContext("2d");

            // Draw a chart
            if (this.showNewCases) {
              chart = new Chart(canvasCtx, {
                type: "line",
                data: {
                  labels: this.totalConfirmedGrowthArray.map((_, i) => i + 1),
                  datasets: [
                    {
                      label: "New Confirmed Cases",
                      data: this.totalConfirmedGrowthArray,
                      backgroundColor: ["rgba(0, 132, 255, 1)"],
                    },
                  ],
                },
              });
            } else {
              chart = new Chart(canvasCtx, {
                type: "line",
                data: {
                  labels: this.totalConfirmedArray.map((_, i) => i + 1),
                  datasets: [
                    {
                      label: "Total Confirmed Cases",
                      data: this.totalConfirmedArray,
                      backgroundColor: ["rgba(0, 132, 255, 1)"],
                    },
                  ],
                },
              });
            }
          },
          done() {
            // stop loading element

            const loadingEl = document.getElementById("loading");
            loadingEl.parentElement.removeChild(loadingEl);
          },
        },
        mounted() {
          fetch("https://api.covid19api.com/total/country/india", {})
            .then((r) => r.json())
            .then(this.main);
        },
      }).mount("#root");
    </script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;1,100;1,300;1,400&display=swap");

      html,
      body {
        padding: 0;
        margin: 0;

        text-align: center;

        background-color: #333;
        color: #eee;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      }

      #root {
        margin-top: 2vh;
        margin-left: 5vw;
        margin-right: 5vw;
        background-color: #555;
        border-radius: 15px;
      }

      #root .latest {
        font-size: 3rem;
        font-weight: 100;
      }

      #loading {
        display: block;
        width: 100vw;
        height: 100vh;
        animation-name: loading;
        animation-iteration-count: infinite;
        animation-duration: 2s;

        text-transform: capitalize;
        font-size: 3rem;
        text-align: center;
        font-weight: 200;
      }

      @keyframes loading {
        from {
          transform: translate(0px, 100vh);
          background-color: rgba(0, 132, 255, 1);
        }
        to {
          transform: translate(0px, 0px);
          background-color: rgba(0, 132, 255, 0);
        }
      }
    </style>
  </body>
</html>
